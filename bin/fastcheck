#!/usr/bin/env bash
set -euo pipefail

echo 'Executing Zeitwerk check'
bin/rails zeitwerk:check

echo 'Executing rubocop'
if ! bin/rubocop
then
  echo 'Rubocop detected issues!'
  bin/rubocop -a

  echo 'Tried to auto correct the issues, but must be reviewed manually, commit aborted'
  exit 1
fi

echo 'Executing brakeman'
bundle exec brakeman -q -z --no-summary --no-pager

echo 'Executing stylelint'
yarn stylelint app/assets/stylesheets/**/*.scss

echo 'Executing eslint'
yarn eslint app/javascript

echo 'Executing erb-lint'
bundle exec erb_lint --config .erb-lint.yml --lint-all
